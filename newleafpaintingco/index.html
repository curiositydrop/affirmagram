<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>New Leaf Painting Co.</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="logo-container">
      <img src="7D16A71A-2AF9-4EBB-863A-09C24D4F6662.png" alt="New Leaf Painting Co. logo" class="logo" />
    </div>

    <nav>
      <ul class="nav-links">
        <li><a href="index.html" class="active">Home</a></li>
        <li><a href="past-projects.html">Past Projects</a></li>
        <li><a href="local-partners.html">Local Partners</a></li>
        <li><a href="#">Schedule Estimate</a></li>
      </ul>
    </nav>
  </header>

  <!-- HERO SECTION -->
  <section class="hero">
    <h1>Turn over a New Leaf — With a fresh new coat, one room at a time.</h1>
    <p>Professional interior painting built on trust, quality, and care.</p>
    <a href="#" class="cta-button">Schedule a Free Estimate</a>
  </section>

  <!-- ABOUT SECTION -->
  <section class="about">
    <h2>Why Choose New Leaf Painting Co.</h2>
    <p>New Leaf Painting Co. isn’t just another painting service — we’re dedicated to giving your home the attention and renewal it deserves. Every brush stroke matters because your space deserves more than a quick coat; it deserves craftsmanship, precision, and pride.</p>

    <ul>
      <li><strong>Professional quality</strong> at fair, transparent prices</li>
      <li><strong>Respect for your home</strong> — we show up on time, protect your space, and clean up fully</li>
      <li><strong>Attention to detail</strong> that transforms a room, not just paints it</li>
      <li><strong>A smooth process</strong> from estimate to final walkthrough</li>
    </ul>
  </section>

  <!-- SERVICES -->
  <section class="services">
    <h2>Our Services</h2>
    <ul>
      <li>Interior wall painting</li>
      <li>Trim, doors, and ceilings</li>
      <li>Accent walls & color matching</li>
      <li>Cabinet refinishing</li>
      <li>Eco-friendly paint options</li>
    </ul>
  </section>

  <!-- TESTIMONIAL -->
  <section class="testimonial">
    <blockquote>
      “They made the process easy from start to finish. The rooms look incredible!”
    </blockquote>
    <p>— Scott L., Buxton, ME</p>
  </section>

  <!-- CONTACT FLOATING BUTTON -->
  <button id="contact-btn">Get free estimate</button>

  <!-- CONTACT POPUP -->
  <div id="contact-popup" class="popup">
    <div class="popup-content">
      <span class="close">&times;</span>
      <h2>Get free estimate</h2>
      <form>
        <label for="name">Name:</label>
        <input type="text" id="name" required>

        <label for="email">Email:</label>
        <input type="email" id="email" required>

        <label for="phone">Phone:</label>
        <input type="tel" id="phone">

        <label for="message">Message:</label>
        <textarea id="message" rows="4"></textarea>

        <input type="hidden" name="discount_code" id="discount-code" value="">

        <button type="submit">Send</button>
      </form>
    </div>
  </div>

  <!-- ABOUT OWNER -->
  <section class="about-owner">
    <h2>About the Owner</h2>
    <p>
      With over <strong>15 years of professional painting experience</strong>, 
      New Leaf Painting Co. was built on a foundation of craftsmanship, reliability, 
      and pride in every project. From family homes to full interior makeovers, 
      we believe every wall deserves a fresh start — one coat and one room at a time.
    </p>
  </section>

  <!-- SERVICE AREA -->
  <section class="service-area">
    <h2>Service Area</h2>
    <p>
      Proudly serving <strong>Southern Maine</strong> and the surrounding areas, 
      including towns within a <strong>50-mile radius of Dayton, ME</strong>.
    </p>
  </section>

  <!-- FOOTER -->
  <footer>
    <img src="7D16A71A-2AF9-4EBB-863A-09C24D4F6662.png" alt="New Leaf Painting Co." class="footer-logo" />
    <p>&copy; 2025 New Leaf Painting Co. | All Rights Reserved</p>
  </footer>

  <!-- JS SCRIPTS -->
 <script>
// --- Popup functionality ---
const popup = document.getElementById("contact-popup");
const btn = document.getElementById("contact-btn");
const close = document.querySelector(".close");

btn.onclick = () => popup.style.display = "flex";
close.onclick = () => popup.style.display = "none";
window.onclick = e => { if (e.target === popup) popup.style.display = "none"; };

// --- URL parameters ---
const urlParams = new URLSearchParams(window.location.search);
let refParam = urlParams.get('ref') || urlParams.get('drop') || urlParams.get('sample');
if (refParam) refParam = refParam.toUpperCase(); // make comparison case-insensitive

// --- Google Sheet JSON setup ---
const sheetURL = "https://docs.google.com/spreadsheets/d/2PACX-1vSGQaoBZ7rMgXkLt9ZvLeF9zZ5V5qv1m4mlWWowx-VskRE6hrd1rHOVAg3M4JJfXCotw8wVVK_nVasH/gviz/tq?tqx=out:json";

let refData = {
  ReferrerName: "",
  ReferrerBusiness: "",
  DiscountCode: "",
  BannerText: "",
  ButtonText: "",
  EmailSubject: ""
};

// --- Fetch referrer info from JSON ---
async function loadReferrerData() {
  if (!refParam) return;

  try {
    const res = await fetch(sheetURL);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2)); // strip Google wrapper
    const rows = json.table.rows;

    console.log("Spreadsheet rows:", rows); // DEBUG: see all rows

    const match = rows.find(r => (r.c[0]?.v || "").toUpperCase() === refParam);
    if (match) {
      refData.ReferrerName = match.c[1]?.v || "";
      refData.ReferrerBusiness = match.c[2]?.v || "";
      refData.DiscountCode = match.c[3]?.v || "";
      refData.BannerText = match.c[4]?.v || "";
      refData.ButtonText = match.c[5]?.v || "";
      refData.EmailSubject = match.c[6]?.v || `New Leaf Painting Inquiry - via ${refData.ReferrerName || refData.ReferrerBusiness}`;
      console.log("Matched refData:", refData); // DEBUG: confirm match
    } else {
      console.log("No matching refParam found in spreadsheet.");
    }
  } catch (err) {
    console.error("Error loading referrer data:", err);
  }
}

// --- Banner ---
function createBanner(message) {
  if (!message) return;
  const banner = document.createElement('div');
  banner.id = "drop-banner";
  banner.textContent = message;
  Object.assign(banner.style, {
    backgroundColor: "#4CAF50",
    color: "#fff",
    textAlign: "center",
    padding: "10px",
    fontWeight: "bold",
    position: "fixed",
    top: "0",
    left: "0",
    width: "100%",
    zIndex: "200"
  });
  document.body.prepend(banner);
}

// --- Update existing button ---
function updateFloatingButton(text) {
  if (!text) return;
  btn.textContent = text;
}

// --- Popup heading ---
function updatePopupHeading() {
  const popupHeading = document.querySelector('#contact-popup h2');
  if (!popupHeading) return;

  if (refData.DiscountCode.toUpperCase().includes("DROP")) popupHeading.textContent = "Redeem Drop Reward";
  else if (refData.DiscountCode.toUpperCase().includes("SAMPLE")) popupHeading.textContent = "Redeem Sample Reward";
}

// --- Initialize ---
async function init() {
  await loadReferrerData();

  if (refData.BannerText) createBanner(refData.BannerText);
  if (refData.ButtonText) updateFloatingButton(refData.ButtonText);
  if (refParam) updatePopupHeading(); // only update popup heading for referred users
}

init();

// --- Form submission ---
const form = document.querySelector('#contact-popup form');
form.addEventListener('submit', e => {
  e.preventDefault();

  const name = document.getElementById('name').value;
  const email = document.getElementById('email').value;
  const phone = document.getElementById('phone').value;
  const message = document.getElementById('message').value;
  const discount = document.getElementById('discount-code').value;

  const subject = encodeURIComponent(refData.EmailSubject || "New Leaf Painting Inquiry");
  const bodyLines = [
    `Name: ${name}`,
    `Email: ${email}`,
    `Phone: ${phone}`,
    `Message: ${message}`,
    `Discount Code: ${discount}`,
    refData.ReferrerName ? `Referrer: ${refData.ReferrerName} ${refData.ReferrerBusiness ? "at " + refData.ReferrerBusiness : ""}` : ""
  ];
  const body = encodeURIComponent(bodyLines.join("\n"));

  window.location.href = `mailto:newleafpaintingcompany@gmail.com?subject=${subject}&body=${body}`;
});
</script>

</body>
</html>
